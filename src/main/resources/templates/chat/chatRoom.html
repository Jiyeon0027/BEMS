<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.2/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<script>
    // 클라이언트 측에서 서버에 stomp 연결 요청을 보내는 코드
    const stompEndPoint = "ws://localhost:8080/ws-stomp";
    const chatRoomURI = "/pub/chatroom/6799826b-bd49-4d30-9311-127f208c995d"

    const socket = new WebSocket(stompEndPoint);
    const stompClient = Stomp.over(socket);

    const uuid = "6799826b-bd49-4d30-9311-127f208c995d";

    // 서버와의 연결이 성공한 경우(stomp 연결이 성공적으로 설정되었음)
    stompClient.connect({}, () => {

        console.log("STOMP 연결 성공!");

        // topic 구독 요청
        stompClient.subscribe("/sub/chatroom/" + uuid, (message) => {

            // 해당 topic에 채팅 메시지(데이터)가 publish된 경우
            const jsonData = JSON.parse(message.body);
            console.log("Received JSON Data: ", jsonData);
        });

        // '전송' 버튼에 이벤트 리스너 부착 - 데이터 발행(pub) 요청
        document.getElementById("sendMessageButton").addEventListener("click", () => {

            const roomId = "6799826b-bd49-4d30-9311-127f208c995d";
            const senderId = 2;
            const senderUsername = "관리사무소2";
            const content = "안녕하세요";
            const sentTime = new Date();

            const chatMsg = {
                "chatRoom": {
                    "roomId": roomId
                },
                "type": "TALK",
                "sender": {
                    "id": senderId,
                    "username": senderUsername
                },
                "content": content,
                "sentTime": sentTime
            };

            stompClient.send(chatRoomURI, {}, JSON.stringify(chatMsg));
        });
    });
</script>
</body>
</html>